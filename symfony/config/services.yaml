services:
  _defaults:
    autowire: true
    autoconfigure: true

  App\:
    resource: '../src/'
    exclude:
      - '../src/Kernel.php'

  # Controllers fuera de src/Controller (Presentation layer)
  App\Presentation\Http\Controller\:
    resource: '../src/Presentation/Http/Controller/'
    tags: ['controller.service_arguments']

  App\Presentation\Http\Controller\Auth\LoginController:
    arguments:
      $cookieSecure: '%env(bool:COOKIE_SECURE)%'
    tags: ['controller.service_arguments']

  App\Presentation\Http\Controller\Auth\RefreshController:
    arguments:
      $cookieSecure: '%env(bool:COOKIE_SECURE)%'
    tags: ['controller.service_arguments']

  # Ports -> Adapters (Clean Architecture)
  App\Application\Shared\Security\AuthorizationServiceInterface:
    class: App\Infrastructure\Security\AuthorizationService

  App\Application\Shared\Port\TransactionInterface:
    class: App\Infrastructure\Persistence\Doctrine\Transaction\DoctrineTransaction

  App\Domain\Offer\Repository\OfferRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineOfferRepository

  App\Application\Shared\Security\CurrentUserProviderInterface:
    class: App\Infrastructure\Security\DoctrineCurrentUserProvider

  App\Domain\Route\Repository\RouteRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineRouteRepository

  App\Domain\Sport\Repository\SportRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineSportRepository

  App\Application\Route\Port\RouteParserInterface:
    class: App\Infrastructure\Route\Parser\GpxRouteParser

  App\Application\Route\Port\RoutePublicReadRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineRoutePublicReadRepository

  App\Application\Offer\Port\OfferPublicReadRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineOfferPublicReadRepository

  # ----- Auth -----

  App\Application\Auth\Port\UserAuthRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineUserAuthRepository

  App\Application\Auth\Port\RefreshSessionRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineRefreshSessionRepository

  App\Application\Auth\Port\TokenBlacklistRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineTokenBlacklistRepository

  App\Application\Auth\Port\PasswordHasherInterface:
    class: App\Infrastructure\Security\SymfonyPasswordHasher

  App\Application\Auth\Port\JwtTokenGeneratorInterface:
    class: App\Infrastructure\Security\LexikJwtTokenGenerator

  App\Application\Auth\Port\ProfileCreatorInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineProfileCreator

  App\Infrastructure\Security\JWTSessionVersionListener:
    tags:
      - { name: kernel.event_listener, event: lexik_jwt_authentication.on_jwt_decoded, method: onJWTDecoded }

  # ----- User -----

  App\Application\User\Port\UserReadRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineUserReadRepository

  App\Application\User\Port\UserWriteRepositoryInterface:
    class: App\Infrastructure\Persistence\Doctrine\Repository\DoctrineUserWriteRepository
